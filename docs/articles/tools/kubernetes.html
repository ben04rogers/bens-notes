<!DOCTYPE html> <html><head>
		<title>Kubernetes</title>
		<base href="..\../">
		<meta id="root-path" root-path="..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="digital-knowledge-garden - Kubernetes">
		<meta property="og:title" content="Kubernetes">
		<meta property="og:description" content="digital-knowledge-garden - Kubernetes">
		<meta property="og:type" content="website">
		<meta property="og:url" content="articles/tools/kubernetes.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="digital-knowledge-garden">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Kubernetes">Kubernetes</h1><div class="el-p"><p dir="auto"><code>winget install Kubernetes.kubectl</code> </p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Clusters -&gt; Nodes -&gt; PODs -&gt; 1 or more containers</li>
<li data-line="1" dir="auto">Controllers (Job / CronJob)</li>
<li data-line="2" dir="auto">Worker</li>
<li data-line="3" dir="auto">Ingress Controller (Nginx)</li>
</ul></div><div class="el-h2 heading-wrapper"><h2 data-heading="Update Kube File" dir="auto" class="heading" id="Update_Kube_File"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Update Kube File</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>aws eks update-kubeconfig --name au-sandbox --region ap-southeast-2</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Kubernetes API" dir="auto" class="heading" id="Kubernetes_API"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Kubernetes API</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>kubectl api-resources</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Namespaces" dir="auto" class="heading" id="Namespaces"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Namespaces</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>kubectl create namespace leandrom</code><br>
<code>kubectl delete namespace leandrom</code><br>
<code>kubectl get namespaces</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="POD" dir="auto" class="heading" id="POD"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>POD</h2><div class="heading-children"><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link" href="https://kubernetes.io/docs/concepts/workloads/pods/" target="_blank">https://kubernetes.io/docs/concepts/workloads/pods/</a><br>
<code>kubectl apply -n leandrom -f hello-world.yml</code><br>
<code>kubectl apply -f hello-world.yml</code><br>
<code>kubectl get pods -n leandrom</code><br>
<code>kubectl describe pod hello-world -n leandrom</code><br>
<code>kubectl logs hello-world -n leandrom</code><br>
<code>kubectl delete pod hello-world -n leandrom</code></p></div><div class="el-p"><p dir="auto"><code>hello-world.yml</code></p></div><div class="el-pre"><pre><code data-line="0">apiVersion: v1
kind: Pod
metadata:
  name: hello-world
  namespace: leandrom
spec:
  restartPolicy: Always
  containers:
    - name: main
      image: busybox
      command: ['sh', '-c', 'echo $MESSAGE &amp;&amp; sleep 10 &amp;&amp; echo Bye!']
      env:
        - name: MESSAGE
          value: "Hello env vars!"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3 heading-wrapper"><h3 data-heading="Restart Policy" dir="auto" class="heading" id="Restart_Policy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Restart Policy</h3><div class="heading-children"><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy" target="_blank">https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy</a></p></div><div class="el-p"><p dir="auto">The <code>spec</code> of a Pod has a <code>restartPolicy</code> field with possible values <code>Always</code>, <code>OnFailure</code>, and <code>Never</code>. The default value is Always.</p></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Controllers" dir="auto" class="heading" id="Controllers"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Controllers</h2><div class="heading-children"><div class="el-h3 heading-wrapper"><h3 data-heading="Jobs" dir="auto" class="heading" id="Jobs"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Jobs</h3><div class="heading-children"><div class="el-p"><p dir="auto"><code>kubectl get job -n leandrom</code><br>
<code>kubectl delete job hellojob -n leandrom</code></p></div><div class="el-pre"><pre><code data-line="0">apiVersion: batch/v1
kind: Job
metadata:
  name: hellojob
  namespace: leandrom
spec:
  completions: 20
  parallelism: 2
  template:
    metadata:
      name: hello-job
    spec:
      containers:
        - name: main
          image: busybox
          command: ['sh', '-c', 'echo $MESSAGE &amp;&amp; sleep 10 &amp;&amp; echo Bye!']
          env:
            - name: MESSAGE
              value: "Hello env vars!"
      restartPolicy: OnFailure
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Cron Jobs" dir="auto" class="heading" id="Cron_Jobs"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Cron Jobs</h3><div class="heading-children"><div class="el-pre"><pre><code data-line="0">apiVersion: batch/v1
kind: CronJob
metadata:
  name: hellocron
  namespace: leandrom
spec:
  schedule: "* * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: main
            image: busybox
            command: ['sh', '-c', 'echo $MESSAGE &amp;&amp; sleep 10 &amp;&amp; echo Bye!']
            env:
              - name: MESSAGE
                value: "Hello env vars!"
          restartPolicy: OnFailure
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Export/Import Resources" dir="auto" class="heading" id="Export/Import_Resources"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Export/Import Resources</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>kubectl get namespace leandrom -o yaml</code><br>
<code>kubectl get pod debian -n leandrom -o yaml</code><br>
<code>kubectl apply -f namespace.yaml</code><br>
<code>kubectl apply -f pod.yaml</code> </p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="POD Controllers" dir="auto" class="heading" id="POD_Controllers"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>POD Controllers</h2><div class="heading-children"><div class="el-p"><p dir="auto">Kubernetes provides 4 types of long running pod controllers:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Deployments - Make sure n pods of the same type are running at any time. More ephemeral. They can share volumes. Best for stateless applications like APIs, microservices, webservers.</li>
<li data-line="1" dir="auto">Statefulsets - Same as deployments but the network name of the pods are consistent and usually don’t share volumes (but might for coordination). Best for stateful applications like databases.</li>
<li data-line="2" dir="auto">Daemonsets - Make sure one pod runs on every host.</li>
<li data-line="3" dir="auto">Replicaset - Light implementation of pod replication that tries to keep a number of pods active at the same time, used by Deployments with improved features. <strong>Do not use directly.</strong></li>
</ul></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Deployment" dir="auto" class="heading" id="Deployment"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Deployment</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>httpd.yml</code></p></div><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> httpd
  namespace<span class="token punctuation">:</span> leandrom
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> httpd_app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">4</span>
  selector<span class="token punctuation">:</span>
      matchLabels<span class="token punctuation">:</span>
        mypod<span class="token punctuation">:</span> httpd_pod
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        mypod<span class="token punctuation">:</span> httpd_pod
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> main
          image<span class="token punctuation">:</span> httpd<span class="token punctuation">:</span>latest
          ports<span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl apply -f httpd.yml</code><br>
<code>kubectl get deployment -n leandrom</code><br>
<code>kubectl get pods -n leandrom</code><br>
<code>kubectl delete pod httpd-68d6cfbc7d-4f7hg -n leandrom</code><br>
<code>kubectl edit deployment httpd -n leandrom</code><br>
<code>kubectl describe deployment -n leandrom</code><br>
<code>kubectl describe pod httpd-68d6cfbc7d-tcw75 -n leandrom</code> (to get POD Internal IP Address)</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Services" dir="auto" class="heading" id="Services"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Services</h2><div class="heading-children"><div class="el-p"><p dir="auto">Each pod in a deployment has its own IP, however due to the dynamic nature of the clusters, pods can change along with their IPs so we can’t just rely on any static configuration. Fortunately Kubernetes has this covered by the Service resource.</p></div><div class="el-p"><p dir="auto">A Kubernetes service is like a routing solution inside the cluster. It exposes all the pods belonging to a deployment, statefulset or daemonset under a static IP and DNS name and it is immediately updated if pods change. Services identify the member pods by labels.</p></div><div class="el-p"><p dir="auto">Kubernetes also has an internal DNS server and every service receives a unique name in the form:</p></div><div class="el-p"><p dir="auto"><code>&lt;servicename&gt;.&lt;namespace&gt;.svc.cluster.local</code></p></div><div class="el-p"><p dir="auto"><code>kubectl get service -n leandrom</code><br>
<code>kubectl describe svc helloworld -n leandrom</code></p></div><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> helloworld
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> leandrom
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">mypod</span><span class="token punctuation">:</span> httpd_pod
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl run debian --image debian -n leandrom -- sleep infinity</code><br>
<code>kubectl exec -ti debian -n leandrom -- bash</code><br>
<code>apt-get update</code><br>
<code>apt-get install -y curl</code><br>
<code>curl helloworld.leandrom.svc.cluster.local</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Ingress" dir="auto" class="heading" id="Ingress"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Ingress</h2><div class="heading-children"><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank">https://kubernetes.io/docs/concepts/services-networking/ingress/</a><br>
<code>kubectl get ingress -n leandrom</code></p></div><div class="el-pre"><pre><code data-line="0">---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: helloworld
  namespace: leandrom
  annotations:
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rewrite-target: "/"
spec:
  ingressClassName: sandbox-nlb
  rules:
  - host: helloworld.sandbox.au.humanforce.com
    http:
      paths:
      - backend:
          service:
            name: helloworld
            port:
              number: 80
        path: /leandrom
        pathType: Prefix
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl get pods -n leandrom</code><br>
<code>kubectl exec -ti httpd-68d6cfbc7d-nmhg8 -n leandrom -- bash</code><br>
<code># echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello World Leo!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' &gt; htdocs/index.html</code> <code># cat htdocs/index.html</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="POD Example" dir="auto" class="heading" id="POD_Example"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>POD Example</h2><div class="heading-children"><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> httpd
  namespace<span class="token punctuation">:</span> leandrom
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> httpd_app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
      matchLabels<span class="token punctuation">:</span>
        mypod<span class="token punctuation">:</span> httpd_pod
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        mypod<span class="token punctuation">:</span> httpd_pod
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> main
          image<span class="token punctuation">:</span> httpd<span class="token punctuation">:</span>latest
          ports<span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> helloworld
  namespace<span class="token punctuation">:</span> leandrom
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  type<span class="token punctuation">:</span> ClusterIP
  selector<span class="token punctuation">:</span>
    mypod<span class="token punctuation">:</span> httpd_pod
  ports<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      targetPort<span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> helloworld
  namespace<span class="token punctuation">:</span> leandrom
  annotations<span class="token punctuation">:</span>
    nginx.ingress.kubernetes.io/force<span class="token punctuation">-</span><span class="token key atrule">ssl-redirect</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
    nginx.ingress.kubernetes.io/rewrite<span class="token punctuation">-</span><span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">"/"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  ingressClassName<span class="token punctuation">:</span> sandbox<span class="token punctuation">-</span>nlb
  rules<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> helloworld.sandbox.au.humanforce.com
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          service<span class="token punctuation">:</span>
            name<span class="token punctuation">:</span> helloworld
            port<span class="token punctuation">:</span>
              number<span class="token punctuation">:</span> <span class="token number">80</span>
        path<span class="token punctuation">:</span> /leandrom
        pathType<span class="token punctuation">:</span> Prefix
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Secrets" dir="auto" class="heading" id="Secrets"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Secrets</h2><div class="heading-children"><div class="el-p"><p dir="auto">Secrets are resources holding a collection of key-value pairs. The most simple way to think about it is like a file with key-value pairs. Secrets can be clear or may be configured as opaque for a bit of obfuscation. More specialised secrets can be configured with third party backing solutions (i.e. Hashicorp Vault). The main objective of a secret is to be used as source for environment variables (but might be mounted as a file as well).</p></div><div class="el-p"><p dir="auto"><code>kubectl get secrets -n leandrom</code><br>
<code>kubectl apply -f secrets.yml</code><br>
<code>kubectl describe secret safe -n leandrom</code><br>
<code>kubectl get secret safe -n leandrom -o yaml</code><br>
<code>kubectl get secret safe -n leandrom -o jsonpath='{.data}'</code> (this will show base64 encoded values)</p></div><div class="el-p"><p dir="auto"><code>secrets.yml</code></p></div><div class="el-pre"><pre><code data-line="0">apiVersion: v1
kind: Secret
metadata:
  name: safe
  namespace: leandrom
type: Opaque
stringData:
  user: leandrom
  pass: "12345"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Consuming the secret</p></div><div class="el-pre"><pre><code data-line="0">---
apiVersion: v1
kind: Pod
metadata:
  name: hello
  namespace: guimo
spec:
  containers:
    - name: main
      image: busybox
      command: ['sh', '-c', 'echo Hello $USER &amp;&amp; sleep 10 &amp;&amp; echo Bye!']
      env:
        - name: USER
          valueFrom:
            secretKeyRef:
              name: safe
              key: user
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl apply -f secrets.yml</code><br>
<code>kubectl logs hello -n leandrom</code><br>
<code>kubectl describe pod hello -n leandrom</code> (environment variables don't show the secrets)</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Configmaps" dir="auto" class="heading" id="Configmaps"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Configmaps</h2><div class="heading-children"><div class="el-p"><p dir="auto">ConfigMaps are used to keep your application code separate from your configuration. Configmaps are very similar to Secrets, indeed a configmap can do almost anything you can do with a secret and even more, however the configmap is never encrypted and not designed to store secret information like passwords or certificates.</p></div><div class="el-p"><p dir="auto">Same as a secret, a configmap is a key value store with the difference a configmap value can be multiline and describe a whole file. You can use it to define env vars but the main purpose is allowing you to define a configuration you would like to be applied at pod startup by mounting those files in the pod.</p></div><div class="el-p"><p dir="auto">For this example, we will replace the index.html from the httpd service we are running for a new file that comes from the configmap. To do this, we are going to use the httpd.yaml file we created in the last session. First make a copy of the httpd.yaml to configmap.yaml (just for safekeeping)</p></div><div class="el-p"><p dir="auto"><code>cp httpd.yml configmap.yml</code><br>
add the below</p></div><div class="el-pre"><pre><code data-line="0">---
apiVersion: v1
kind: ConfigMap
metadata:
  name: httpd
  namespace: guimo
data:
  index.html: |
    &lt;html&gt;&lt;body&gt;&lt;h1&gt;This file comes from my configmap&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl apply -f configmap.yml -n leandrom</code><br>
<code>kubectl describe configmap httpd -n leandrom</code></p></div><div class="el-p"><p dir="auto">So we have a configmap, now we need to mount this to the container. Edit your configmap.yaml file in the Deployment definition so it looks like this:</p></div><div class="el-pre"><pre><code data-line="0">apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpd
  namespace: leandrom
  labels:
    app: httpd_app
spec:
  replicas: 1
  selector:
      matchLabels:
        mypod: httpd_pod
  template:
    metadata:
      labels:
        mypod: httpd_pod
    spec:
      containers:
        - name: main
          image: httpd:latest
          ports:
            - containerPort: 80
          volumeMounts:
          - name: index-config
            mountPath: /usr/local/apache2/htdocs
      volumes:
        - name: index-config
          configMap:
            name: httpd
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl apply -f configmap.yml -n leandrom</code><br>
<code>curl https://helloworld.sandbox.au.humanforce.com/leandrom</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Mounting persistent volumes" dir="auto" class="heading" id="Mounting_persistent_volumes"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Mounting persistent volumes</h2><div class="heading-children"><div class="el-p"><p dir="auto">As mentioned before, Persistent volumes are used to keep data generated by a service. Just don’t get confused by the term “persistent”, given the dynamic nature of cloud resources, we can spawn a volume for a couple hours then terminate them once we are done. By doing this we are never constrained to the host node restrictions.</p></div><div class="el-p"><p dir="auto">For example, a host node may have a 50GB disk, but we need to uncompress a file of about 100GB size, then we can spawn a 100GB volume, attach to the pod, run our process then release the volume.</p></div><div class="el-p"><p dir="auto">Kubernetes uses two levels of abstraction of the underlying file storage to mount filesystems to the pod.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Persistent Volume (pv) - Describes the resource in its most basic level backed by a real resource like an EBS volume, an EFS/NFS storage and similar. When a PV is created, a real volume is created in the cloud.<br>
</li>
<li data-line="2" dir="auto">Persistent Volume Claim (pvc) - Is a request of storage space. When a PVC is created, the cluster will look for PVs with matching attributes and reserve the requested space if available. PVCs are then attached to pods via volumeMounts. Kubernetes can detach and reattach a PV and PVC to the appropriate nodes following the pod that requires them.<br>
</li>
</ul></div><div class="el-p"><p dir="auto">Our clusters are configured with a dynamic provisioning that will automatically create a PV when a PVC is created, but it is possible to create the PV if you prefer a more fine grained control.</p></div><div class="el-p"><p dir="auto"><code>kubectl get storageclass</code></p></div><div class="el-pre"><pre><code data-line="0">ebs-gp2         ebs.csi.aws.com         Delete          WaitForFirstConsumer   true  
gp2 (default)   kubernetes.io/aws-ebs   Delete          WaitForFirstConsumer   false 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>volume.yml</code></p></div><div class="el-pre"><pre><code data-line="0">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bigdisk
  namespace: leandrom
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: ebs-gp2
  resources:
    requests:
      storage: 30Gi
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>kubectl apply -f volume.yml</code></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="## Init Containers" dir="auto" class="heading" id="##_Init_Containers"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>## Init Containers</h3><div class="heading-children"><div class="el-p"><p dir="auto">The idea of an init container is to execute some startup commands using public images without having to embed those commands into the main container image. As they work like regular pods, it is possible to mount shared filesystems or empty folders so they can write the command outputs for coordination; and as they are guaranteed to execute sequentially it is easy to coordinate the outputs as next step inputs.</p></div><div class="el-p"><p dir="auto"><code>volumes.yml</code></p></div><div class="el-p"><p dir="auto"><code>kubectl delete pod volumes -n leandrom</code><br>
<code>kubectl apply -f volumes.yml</code></p></div><div class="el-pre"><pre><code data-line="0">apiVersion: v1
kind: Pod
metadata:
  name: volumes
  namespace: leandrom
spec:
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  initContainers:
    - name: download
      image: curlimages/curl:latest
      command: ['sh', '-c', "curl google.com -o /write/google.html"]
      volumeMounts:
        - mountPath: /write
          name: shared-volume
  containers:
    - name: app
      image: busybox:1.28
      command: ['sh', '-c', 'cat /read/google.html']
      volumeMounts:
        - mountPath: /read
          name: shared-volume
  volumes:
    - name: shared-volume
      emptyDir:
        sizeLimit: 100Mi
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="References" dir="auto" class="heading" id="References"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>References</h2><div class="heading-children"><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link" href="https://kubernetes.io/docs/concepts/" target="_blank">https://kubernetes.io/docs/concepts/</a><br>
<a data-tooltip-position="top" aria-label="https://medium.com/google-cloud/kubernetes-101-pods-nodes-containers-and-clusters-c1509e409e16" rel="noopener nofollow" class="external-link" href="https://medium.com/google-cloud/kubernetes-101-pods-nodes-containers-and-clusters-c1509e409e16" target="_blank">Kubernetes 101: Pods, Nodes, Containers, and Clusters</a><br>
<a rel="noopener nofollow" class="external-link" href="https://kubernetes.io/docs/concepts/overview/components/" target="_blank">https://kubernetes.io/docs/concepts/overview/components/</a><br>
<a rel="noopener nofollow" class="external-link" href="https://12factor.net/" target="_blank">https://12factor.net/</a> <a href="?query=tag:Architecture" class="tag" target="_blank" rel="noopener nofollow">#Architecture</a> </p></div><div class="mod-footer mod-ui"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="articles\tools\kubernetes.html#Kubernetes"><div class="tree-item-contents heading-link" heading-name="Kubernetes"><span class="tree-item-title">Kubernetes</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Update_Kube_File"><div class="tree-item-contents heading-link" heading-name="Update Kube File"><span class="tree-item-title">Update Kube File</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Kubernetes_API"><div class="tree-item-contents heading-link" heading-name="Kubernetes API"><span class="tree-item-title">Kubernetes API</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Namespaces"><div class="tree-item-contents heading-link" heading-name="Namespaces"><span class="tree-item-title">Namespaces</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#POD"><div class="tree-item-contents heading-link" heading-name="POD"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">POD</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="articles\tools\kubernetes.html#Restart_Policy"><div class="tree-item-contents heading-link" heading-name="Restart Policy"><span class="tree-item-title">Restart Policy</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Controllers"><div class="tree-item-contents heading-link" heading-name="Controllers"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Controllers</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="articles\tools\kubernetes.html#Jobs"><div class="tree-item-contents heading-link" heading-name="Jobs"><span class="tree-item-title">Jobs</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="articles\tools\kubernetes.html#Cron_Jobs"><div class="tree-item-contents heading-link" heading-name="Cron Jobs"><span class="tree-item-title">Cron Jobs</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Export/Import_Resources"><div class="tree-item-contents heading-link" heading-name="Export/Import Resources"><span class="tree-item-title">Export/Import Resources</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#POD_Controllers"><div class="tree-item-contents heading-link" heading-name="POD Controllers"><span class="tree-item-title">POD Controllers</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Deployment"><div class="tree-item-contents heading-link" heading-name="Deployment"><span class="tree-item-title">Deployment</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Services"><div class="tree-item-contents heading-link" heading-name="Services"><span class="tree-item-title">Services</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Ingress"><div class="tree-item-contents heading-link" heading-name="Ingress"><span class="tree-item-title">Ingress</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#POD_Example"><div class="tree-item-contents heading-link" heading-name="POD Example"><span class="tree-item-title">POD Example</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Secrets"><div class="tree-item-contents heading-link" heading-name="Secrets"><span class="tree-item-title">Secrets</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Configmaps"><div class="tree-item-contents heading-link" heading-name="Configmaps"><span class="tree-item-title">Configmaps</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#Mounting_persistent_volumes"><div class="tree-item-contents heading-link" heading-name="Mounting persistent volumes"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Mounting persistent volumes</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="articles\tools\kubernetes.html###_Init_Containers"><div class="tree-item-contents heading-link" heading-name="## Init Containers"><span class="tree-item-title"><h2 data-heading="Init Containers" dir="auto">Init Containers</h2></span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="articles\tools\kubernetes.html#References"><div class="tree-item-contents heading-link" heading-name="References"><span class="tree-item-title">References</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>